{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://oh-my-claude-code.dev/schema/plugin/v2.json",
  "title": "Claude Code Plugin Schema v2",
  "description": "Schema for Claude Code plugin manifest with dependencies, integrity, and permissions",
  "type": "object",
  "required": ["name", "version", "description"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "schemaVersion": {
      "type": "string",
      "const": "2.0.0",
      "description": "Schema version identifier"
    },
    "name": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "minLength": 1,
      "maxLength": 64,
      "description": "Plugin name (lowercase, alphanumeric, hyphens only)"
    },
    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "description": "Semantic version (semver)"
    },
    "description": {
      "type": "string",
      "maxLength": 500,
      "description": "Brief description of the plugin"
    },
    "author": {
      "oneOf": [
        { "type": "string" },
        {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "email": { "type": "string", "format": "email" },
            "url": { "type": "string", "format": "uri" }
          },
          "required": ["name"]
        }
      ],
      "description": "Plugin author information"
    },
    "license": {
      "type": "string",
      "description": "SPDX license identifier (e.g., MIT, Apache-2.0)"
    },
    "repository": {
      "type": "object",
      "properties": {
        "type": { "type": "string", "enum": ["git", "svn", "mercurial"] },
        "url": { "type": "string", "format": "uri" },
        "directory": { "type": "string" }
      },
      "required": ["type", "url"],
      "description": "Source code repository"
    },
    "homepage": {
      "type": "string",
      "format": "uri",
      "description": "Plugin homepage URL"
    },
    "keywords": {
      "type": "array",
      "items": { "type": "string", "pattern": "^[a-z0-9-]+$" },
      "uniqueItems": true,
      "maxItems": 20,
      "description": "Keywords for search discovery"
    },
    "categories": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "ai-agent",
          "code-generation",
          "code-review",
          "orchestration",
          "testing",
          "documentation",
          "security",
          "performance",
          "utility",
          "integration"
        ]
      },
      "uniqueItems": true,
      "description": "Plugin categories"
    },
    "engines": {
      "type": "object",
      "properties": {
        "claude-code": { "type": "string", "description": "Claude Code version range" },
        "node": { "type": "string", "description": "Node.js version range" }
      },
      "description": "Runtime requirements"
    },
    "dependencies": {
      "type": "object",
      "additionalProperties": {
        "type": "string",
        "description": "Semver version range"
      },
      "description": "Required plugin dependencies"
    },
    "optionalDependencies": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "description": "Optional plugin dependencies"
    },
    "peerDependencies": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "description": "Peer plugin dependencies"
    },
    "compatibility": {
      "type": "object",
      "properties": {
        "platforms": {
          "type": "array",
          "items": { "type": "string", "enum": ["darwin", "linux", "win32"] }
        },
        "minClaudeCodeVersion": { "type": "string" }
      },
      "description": "Platform compatibility"
    },
    "integrity": {
      "type": "object",
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": ["sha256", "sha384", "sha512"],
          "default": "sha256"
        },
        "hash": { "type": "string", "pattern": "^[a-f0-9]+$" },
        "signature": { "type": "string", "description": "Base64 encoded signature" }
      },
      "required": ["algorithm", "hash"],
      "description": "Integrity verification data"
    },
    "permissions": {
      "type": "object",
      "properties": {
        "required": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Required tool permissions"
        },
        "optional": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Optional tool permissions"
        }
      },
      "description": "Tool permission declarations"
    },
    "hooks": {
      "type": "object",
      "properties": {
        "preInstall": { "type": "string", "description": "Script to run before installation" },
        "postInstall": { "type": "string", "description": "Script to run after installation" },
        "preUninstall": { "type": "string", "description": "Script to run before uninstallation" },
        "postUninstall": { "type": "string", "description": "Script to run after uninstallation" },
        "preUpdate": { "type": "string", "description": "Script to run before update" },
        "postUpdate": { "type": "string", "description": "Script to run after update" }
      },
      "description": "Lifecycle hook scripts"
    },
    "exports": {
      "type": "object",
      "properties": {
        "commands": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns for command files"
        },
        "skills": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns for skill files"
        },
        "agents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns for agent files"
        },
        "hooks": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns for hook files"
        },
        "config": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns for config files"
        }
      },
      "description": "Exported file patterns"
    },
    "funding": {
      "oneOf": [
        { "type": "string", "format": "uri" },
        {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["github", "patreon", "opencollective", "custom"] },
            "url": { "type": "string", "format": "uri" }
          },
          "required": ["type", "url"]
        }
      ],
      "description": "Funding information"
    },
    "deprecated": {
      "oneOf": [
        { "type": "boolean" },
        { "type": "string", "description": "Deprecation message or replacement plugin" }
      ],
      "description": "Deprecation status"
    }
  },
  "additionalProperties": false
}
