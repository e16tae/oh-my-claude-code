# Memory Loop Plugin

무제한 기억력 시스템 - Context/Todos/Insights 파일로 메모리를 외부화하여 대량 작업 시 컨텍스트 리셋에도 작업을 지속할 수 있습니다.

## 개요

AI의 컨텍스트 윈도우 한계를 극복하기 위한 플러그인입니다. 대량 작업 시 자동으로 활성화되며, 3개의 마크다운 파일로 작업 상태를 외부에 저장합니다.

### 핵심 개념

| 파일 | 용도 |
|-----|-----|
| `context.md` | 작업 목표 및 현재 상태 (컨텍스트 리셋 후 복구용) |
| `todos.md` | 체크리스트 (진행률 추적, 중단점 파악) |
| `insights.md` | 발견사항 기록 (학습한 내용 영구 저장) |

## 설치

```bash
# oh-my-claude-code 마켓플레이스에서 설치
claude plugin install memory-loop
```

## 작동 방식

### 완전 자동화 (v1.2.0+)

모든 상황에서 메모리 파일이 **자동으로 생성/복구/정리**됩니다:

| 트리거 | 자동 동작 |
|--------|----------|
| 키워드 감지 | `.memory/` + 파일 자동 생성 |
| 파일 수 감지 (10개+) | `.memory/` + 파일 자동 생성 |
| 세션 시작 (복구) | 누락 파일 자동 재생성 |
| 컨텍스트 압축 | `.memory/` 없으면 자동 생성 |
| 작업 완료 | 자동 아카이브 (옵션) |

### 자동 활성화 조건

1. **키워드 감지**: 프롬프트에 대량 작업 키워드 포함 시
   - 한국어: "전체", "모든", "대량", "리팩토링", "마이그레이션"
   - 영어: "all", "entire", "bulk", "migration", "refactor"

2. **파일 수 감지**: Glob 도구로 10개 이상의 파일이 검색될 때

3. **컨텍스트 압축**: 압축 직전 자동 활성화 (안전망)

### Hook 이벤트

| Hook | 동작 |
|------|-----|
| `SessionStart` | 기존 `.memory/` 복구 + **누락 파일 자동 재생성** |
| `UserPromptSubmit` | 키워드 감지 → **자동 파일 생성** |
| `PostToolUse` | Glob 파일 수 확인 → **자동 파일 생성** |
| `PreCompact` | `.memory/` 없으면 **자동 생성** + 업데이트 경고 |
| `Stop` | 상태 저장 + **작업 완료 감지** + 자동 아카이브 |

## 사용 예시

### 예시 1: 키워드로 자동 활성화

```
사용자: 전체 컴포넌트를 TypeScript로 마이그레이션해줘

======================================
  Memory Loop 활성화됨 (키워드 감지)
======================================

  대량 작업 키워드가 감지되었습니다.

  .memory/ 에 다음 파일들이 자동 생성되었습니다:
    - context.md  : 작업 목표 및 현재 상태
    - todos.md    : 체크리스트
    - insights.md : 발견사항 기록

  [중요] 작업 시작 전 context.md의 Mission을 작성하세요.

======================================
```

### 예시 2: 세션 복구 + 누락 파일 재생성

```
(새 세션 시작, 기존 .memory/ 발견, todos.md 누락)

======================================
  Memory Loop: 세션 복구
======================================

  기존 메모리 파일:
    - context.md:  O
    - todos.md:    X
    - insights.md: O

  [자동 생성] 누락된 1개 파일이 생성되었습니다.

  [중요] .memory/ 파일들을 읽고
        중단점부터 작업을 재개하세요.

======================================
```

### 예시 3: 컨텍스트 압축 시 자동 생성

```
(컨텍스트 압축 임박, .memory/ 미존재)

==========================================
  Memory Loop: 컨텍스트 압축 임박!
==========================================

  [자동 생성] .memory/ 디렉토리와 파일이
              자동으로 생성되었습니다.

  지금 바로 메모리 파일을 작성하세요:

  1. context.md
     - 'Mission'에 작업 목표 작성
     - 'Current State' 섹션을 최신 상태로
     - 'Next Steps'에 다음 작업 명시
  ...

==========================================
```

### 예시 4: 작업 완료 감지

```
(모든 todos.md 체크박스 완료)

======================================
  Memory Loop: 작업 완료 감지
======================================

  모든 할 일이 완료되었습니다!
  (15/15)

  정리하려면 .memory/ 를 삭제하세요.
  또는 config.json에서 autoArchive: true 설정

======================================
```

### 예시 5: 자동 아카이브 (autoArchive: true)

```
(모든 todos.md 체크박스 완료, autoArchive 활성화)

======================================
  Memory Loop: 작업 완료 & 자동 아카이브
======================================

  모든 할 일이 완료되었습니다!
  (15/15)

  [아카이브 완료]
  .memory-archive/20240115_143022

======================================
```

## 실제 워크플로우

### 1. 자동 활성화 후

플러그인이 활성화되면 `.memory/` 디렉토리와 파일들이 **자동으로 생성**됩니다:

```
.memory/
├── context.md    # 작업 목표 및 현재 상태 (자동 생성)
├── todos.md      # 체크리스트 (자동 생성)
├── insights.md   # 발견사항 (자동 생성)
└── .state.json   # 플러그인 상태 (내부용)
```

### 2. Mission 작성

자동 생성된 `context.md` 파일을 열고 **Mission 섹션**을 작성하세요:

```markdown
## Mission (불변)
전체 컴포넌트를 TypeScript로 마이그레이션하고 타입 안전성 확보
```

### 3. 작업 중

- 매 작업 단위 완료 시 `todos.md` 체크박스 업데이트
- 중요 발견 시 `insights.md`에 즉시 기록
- 주요 마일스톤 완료 시 `context.md` "Current State" 업데이트

### 4. 컨텍스트 리셋 후

1. `.memory/` 파일들 읽기 (자동으로 누락 파일 재생성됨)
2. `context.md`의 "Next Steps" 확인
3. `todos.md`의 미완료 항목 확인
4. 중단점부터 작업 재개

### 5. 작업 완료

- `todos.md`의 모든 체크박스가 완료되면 자동 감지
- `autoArchive: true` 설정 시 자동으로 아카이브 후 정리
- 아카이브된 메모리는 `.memory-archive/` 에 타임스탬프별로 저장

## 설정

`config.json` 파일에서 설정을 조정할 수 있습니다:

```json
{
  "fileCountThreshold": 10,
  "keywords": ["전체", "모든", "대량", "all", "entire", "bulk", "migration", "refactor", "리팩토링", "마이그레이션"],
  "memoryDirectory": ".memory",
  "autoArchive": false,
  "archiveDirectory": ".memory-archive"
}
```

| 옵션 | 기본값 | 설명 |
|-----|-------|-----|
| `fileCountThreshold` | 10 | 자동 활성화 파일 수 임계값 |
| `keywords` | [...] | 자동 활성화 키워드 목록 |
| `memoryDirectory` | ".memory" | 메모리 파일 저장 디렉토리 |
| `autoArchive` | false | 작업 완료 시 자동 아카이브 |
| `archiveDirectory` | ".memory-archive" | 아카이브 저장 디렉토리 |

## 파일 구조

```
plugins/memory-loop/
├── .claude-plugin/
│   └── plugin.json       # 플러그인 매니페스트 + Hook 정의
├── scripts/
│   ├── session-start.sh  # 세션 복구 + 누락 파일 재생성
│   ├── prompt-submit.sh  # 키워드 감지 + 파일 생성
│   ├── post-tool-use.sh  # 파일 수 감지 + 파일 생성
│   ├── pre-compact.sh    # 압축 전 자동 생성 + 경고
│   └── stop.sh           # 상태 저장 + 완료 감지 + 아카이브
├── templates/
│   ├── context.md        # context.md 템플릿
│   ├── todos.md          # todos.md 템플릿
│   └── insights.md       # insights.md 템플릿
├── config.json           # 플러그인 설정
└── README.md
```

## 비활성화

메모리 시스템 없이 작업하려면:

- 프롬프트에 "메모리 없이" 또는 "without memory" 포함
- `.memory/` 디렉토리 삭제

## 참고

이 플러그인은 Dylan Davis의 "무제한 기억력" 워크플로우를 기반으로 합니다.

## 라이선스

MIT License
